<div class="container-fluid">
  <p-dialog 
    [header]="coauthors.name" 
    [(visible)]="isDisplayCoauthors" 
    [style]="{width: '600px'}" 
    [baseZIndex]="10000"
    [modal]="true"
    [dismissableMask]="true"
  >
    <p-table
      [value]="coauthors.lists"
      styleClass="p-datatable-sm p-datatable-gridlines"
    >
      <ng-template pTemplate="header" let-columns>
        <tr>
          <th width="2%"> № </th>
          <th width="60%"> ФИО </th>
          <th width="20%"> Подразделение </th>
          <th width="20%"> Телефон </th>
        </tr>
      </ng-template>

      <ng-template pTemplate="body" let-rowData let-rowIndex="rowIndex">
        <tr>
          <td> {{ rowIndex + 1 }} </td>
          <td> {{ rowData.fio }} </td>
          <td> {{ rowData.dept }} </td>
          <td> {{ rowData.phone }} </td>
        </tr>
      </ng-template>
    </p-table>
  </p-dialog>

  <p-dialog 
    [header]="annotation.name" 
    [(visible)]="isDisplayAnnotation" 
    [style]="{width: '600px'}" 
    [baseZIndex]="10000"
    [modal]="true"
    [dismissableMask]="true"
  >
    <h6>
      {{ annotation.text }}
    </h6>
  </p-dialog>

  <div class="row">
    <ng-container *ngIf="lists$ | async as data">
      <p-table
        #dtable
        [value]="data"
        dataKey="id"
        styleClass="p-datatable-sm p-datatable-gridlines"
        [paginator]="true"
        [rows]="10"
        [showCurrentPageReport]="true"
        currentPageReportTemplate="Показано с {first} по {last} из {totalRecords} записей"
      >    
        <ng-template pTemplate="header" class="flex">
          <tr>
            <th class="w-1" style="text-align:center"> № п/п </th>
            <th class="w-2" style="text-align:center"> Название рацпредложения </th>
            <th class="w-1" style="text-align:center"> Аннотация </th>
            <th class="w-1" style="text-align:center"> Дата подачи </th>
            <th class="w-1" style="text-align:center"> Статус </th>

            <th class="w-1" style="text-align:center"> № решения Экспертного совета </th>

            <th class="w-1" style="text-align:center"> Направление </th>
            <th class="w-1" style="text-align:center"> Серийное производство </th>
            <th class="w-1" style="text-align:center"> Профильное подразделение </th>
            <th class="w-1" style="text-align:center"> Ключевые слова </th>

            <th class="w-2" style="text-align:center"> ФИО автора </th>
            <th class="w-1" style="text-align:center"> Подразделение </th>
            <th class="w-1" style="text-align:center"> Телефон </th>

            <th class="w-1" style="text-align:center"> Авторский состав </th>
            <th class="w-1" style="text-align:center"> Материалы </th>

            <th class="w-3" style="text-align:center"> Аналоги </th>
          </tr>
        </ng-template>

        <ng-template pTemplate="body" let-column let-i="rowIndex" let-expanded="expanded">
          <tr>
            <td style="text-align:center">{{ i + 1 }}</td>
            <td style="text-align:center">{{ column.name }}</td>
            <td style="text-align:center">
              <button 
                type="button" 
                pButton 
                pRipple
                label="Смотреть" 
                (click)="onShowAnnotation(column.name, column.annotation)"
                class="btn btn-sm old-style"
              ></button>
            </td>
            <td style="text-align:center">{{ column.creation_datetime | date: 'dd.MM.yyyy'  }}</td>
            <td style="text-align:center">
              <span
                [innerHtml]="column.status_id | describeNameStatus: filters.statuses"
                [class]="'list-badge status-' + column.status_id"
              >
              </span>
            </td>

            <td style="text-align:center">
              <div *ngIf="column.expert_number; else emptyValue">
                {{ column.expert_number }}
              </div>
            </td>

            <td style="text-align:center">
              <span
                [innerHtml]="column.trend_id | describeNameTrend: filters.trends"
              >
              </span>
            </td>
            <td style="text-align:center">
              <span
                [innerHtml]="column.serial | describeNameSerial: filters.serials"
              >
              </span>
            </td>
            <td style="text-align:center">{{ column.profile_depts }}</td>
            <td style="text-align:center">{{ column.tags }}</td>


            <td style="text-align:center">{{ column.author_info.fio }}</td>
            <td style="text-align:center">{{ column.author_info.dept }}</td>
            <td style="text-align:center">{{ column.author_info.phone }}</td>

            <td style="text-align:center">
              <!-- {{ column.coauthor_info }} -->
              <span *ngIf="column.coauthor_info.length == 0">
                Отстутствует
              </span>
              <span *ngIf="column.coauthor_info.length > 0">
                <button 
                type="button" 
                pButton 
                pRipple
                label="Смотреть" 
                (click)="onShowCoauthors(column.name, column.coauthor_info)"
                class="btn btn-sm old-style"
              ></button>
              </span>
            </td>
            <td style="text-align:center">
              <span *ngIf="column.files.length == 0">
                Отстутствуют
              </span>
              <span *ngIf="column.files.length > 0">
                <button 
                  type="button" 
                  pButton 
                  pRipple 
                  [label]="column.files.length" 
                  icon="pi pi-file" 
                  (click)="menu.toggle($event)"
                  class="btn btn-sm old-style"
                ></button>
                <p-menu #menu [popup]="true" appendTo="body" [model]="onGeListFiles(column.files)"></p-menu>
              </span>
            </td>

            <td style="text-align:center">
              <div *ngIf="column.analogs; else emptyValue">
                {{ column.analogs }}
              </div>
            </td> 
          </tr>
        </ng-template>

      </p-table>
    </ng-container>

  </div>
</div>

<ng-template #emptyValue>
  <p> - </p>
</ng-template>